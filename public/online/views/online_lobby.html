<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ãƒ«ãƒ¼ãƒ ãƒ­ãƒ“ãƒ¼ - ã‚ªãƒ³ãƒ©ã‚¤ãƒ³ãƒ—ãƒ¬ã‚¤ | Tokyo Flag Capturing Geoguesser</title>
    <link rel="icon" type="image/x-icon" href="/favicon.ico">
    <link rel="stylesheet" href="/online/online_rooms.css">
</head>
<body>
    <script>
        let roomId = null;
        let currentUser = null;
        let isHost = false;
        let pollInterval = null;

        // ãƒšãƒ¼ã‚¸ãƒ­ãƒ¼ãƒ‰æ™‚ã®åˆæœŸåŒ–
        document.addEventListener('DOMContentLoaded', async () => {
            console.log('lobby page loading...');

            // ãƒªãƒ€ã‚¤ãƒ¬ã‚¯ãƒˆãƒ«ãƒ¼ãƒ—é˜²æ­¢ç”¨ãƒ•ãƒ©ã‚°
            if (sessionStorage.getItem('lobbyRedirecting') === 'true') {
                console.log('ãƒªãƒ€ã‚¤ãƒ¬ã‚¯ãƒˆãƒ«ãƒ¼ãƒ—ã‚’æ¤œå‡ºã€ãƒ«ãƒ¼ãƒ—ã‚’ä¸­æ–­');
                showError('èªè¨¼ã‚¨ãƒ©ãƒ¼ãŒç™ºç”Ÿã—ã¾ã—ãŸã€‚å†åº¦ãƒ­ã‚°ã‚¤ãƒ³ã—ã¦ãã ã•ã„ã€‚');
                sessionStorage.removeItem('lobbyRedirecting');
                return;
            }

            try {
                // URLãƒ‘ãƒ©ãƒ¡ãƒ¼ã‚¿ã‹ã‚‰ãƒ«ãƒ¼ãƒ IDã‚’å–å¾—
                const urlParams = new URLSearchParams(window.location.search);
                roomId = urlParams.get('roomId');

                console.log('Room ID:', roomId);

                if (!roomId) {
                    showError('ãƒ«ãƒ¼ãƒ IDãŒæŒ‡å®šã•ã‚Œã¦ã„ã¾ã›ã‚“');
                    return;
                }

                console.log('èªè¨¼çŠ¶æ…‹ãƒã‚§ãƒƒã‚¯é–‹å§‹...');

                // èªè¨¼çŠ¶æ…‹ã‚’ãƒã‚§ãƒƒã‚¯
                const authResponse = await fetch('/auth/me', {
                    credentials: 'include'
                });

                console.log('èªè¨¼ãƒ¬ã‚¹ãƒãƒ³ã‚¹:', authResponse.status, authResponse.ok);

                if (!authResponse.ok) {
                    console.error('èªè¨¼ãƒã‚§ãƒƒã‚¯ã‚¨ãƒ©ãƒ¼:', authResponse.status);
                    sessionStorage.setItem('lobbyRedirecting', 'true');
                    setTimeout(() => {
                        window.location.href = '/login?returnUrl=' + encodeURIComponent(`/online/views/online_lobby.html?roomId=${roomId}`);
                    }, 1000);
                    return;
                }

                const authData = await authResponse.json();
                console.log('èªè¨¼ãƒ‡ãƒ¼ã‚¿:', authData);

                if (!authData || !authData.success || !authData.data) {
                    console.error('èªè¨¼å¤±æ•—ã¾ãŸã¯ãƒ¦ãƒ¼ã‚¶ãƒ¼æƒ…å ±ãªã—:', authData);
                    sessionStorage.setItem('lobbyRedirecting', 'true');
                    setTimeout(() => {
                        window.location.href = '/login?returnUrl=' + encodeURIComponent(`/online/views/online_lobby.html?roomId=${roomId}`);
                    }, 1000);
                    return;
                }

                currentUser = authData.data; // authData.user -> authData.data
                console.log('èªè¨¼æ¸ˆã¿ãƒ¦ãƒ¼ã‚¶ãƒ¼:', currentUser);

                // ãƒ­ãƒ“ãƒ¼æ©Ÿèƒ½ã‚’åˆæœŸåŒ–
                await initializeLobby();

                // å®šæœŸçš„ã«ãƒ«ãƒ¼ãƒ æƒ…å ±ã‚’æ›´æ–°
                startPolling();

            } catch (error) {
                console.error('åˆæœŸåŒ–ã‚¨ãƒ©ãƒ¼:', error);
                showError(`ãƒšãƒ¼ã‚¸ã®åˆæœŸåŒ–ã«å¤±æ•—ã—ã¾ã—ãŸ: ${error.message}`);
            }
        });

        async function initializeLobby() {
            // ãƒ«ãƒ¼ãƒ æƒ…å ±ã‚’å–å¾—
            await updateRoomInfo();

            // ãƒœã‚¿ãƒ³ã‚¤ãƒ™ãƒ³ãƒˆãƒªã‚¹ãƒŠãƒ¼ã‚’è¨­å®š
            document.getElementById('ready-btn')?.addEventListener('click', handleReadyOrStart);
            document.getElementById('leave-room-btn')?.addEventListener('click', leaveRoom);
        }

        async function updateRoomInfo() {
            try {
                console.log('ãƒ«ãƒ¼ãƒ æƒ…å ±å–å¾—é–‹å§‹...', roomId);

                const response = await fetch(`/multi/rooms/${roomId}`, {
                    credentials: 'include'
                });

                console.log('ãƒ«ãƒ¼ãƒ æƒ…å ±ãƒ¬ã‚¹ãƒãƒ³ã‚¹:', response.status, response.ok);

                // ãƒ¬ã‚¹ãƒãƒ³ã‚¹ã®çŠ¶æ…‹ã‚’ç¢ºèª
                if (!response.ok) {
                    console.error('HTTP Error:', response.status, response.statusText);
                    if (response.status === 401) {
                        showError('èªè¨¼ã‚¨ãƒ©ãƒ¼: ãƒ­ã‚°ã‚¤ãƒ³ã—ã¦ãã ã•ã„');
                        stopPolling(); // ãƒãƒ¼ãƒªãƒ³ã‚°ã‚’åœæ­¢
                        sessionStorage.setItem('lobbyRedirecting', 'true');
                        setTimeout(() => {
                            window.location.href = '/login';
                        }, 2000);
                        return;
                    }
                    if (response.status === 404) {
                        showError('ãƒ«ãƒ¼ãƒ ãŒè¦‹ã¤ã‹ã‚Šã¾ã›ã‚“');
                        stopPolling();
                        return;
                    }
                    showError(`ã‚µãƒ¼ãƒãƒ¼ã‚¨ãƒ©ãƒ¼: ${response.status}`);
                    return;
                }

                const data = await response.json();
                console.log('Room data received:', data);

                if (data.success) {
                    // æ­£å¸¸ã«ãƒ‡ãƒ¼ã‚¿ã‚’å–å¾—ã§ããŸå ´åˆã€ãƒªãƒ€ã‚¤ãƒ¬ã‚¯ãƒˆãƒ•ãƒ©ã‚°ã‚’ã‚¯ãƒªã‚¢
                    sessionStorage.removeItem('lobbyRedirecting');
                    renderRoomInfo(data.data);
                } else {
                    console.error('ãƒ«ãƒ¼ãƒ æƒ…å ±å–å¾—å¤±æ•—:', data);
                    showError(data.message || 'ãƒ«ãƒ¼ãƒ æƒ…å ±ã®å–å¾—ã«å¤±æ•—ã—ã¾ã—ãŸ');
                }

            } catch (error) {
                console.error('ãƒ«ãƒ¼ãƒ æƒ…å ±å–å¾—ã‚¨ãƒ©ãƒ¼:', error);
                showError(`ãƒãƒƒãƒˆãƒ¯ãƒ¼ã‚¯ã‚¨ãƒ©ãƒ¼: ${error.message}`);
                // ãƒãƒƒãƒˆãƒ¯ãƒ¼ã‚¯ã‚¨ãƒ©ãƒ¼ã®å ´åˆã¯ãƒãƒ¼ãƒªãƒ³ã‚°ã‚’åœæ­¢
                stopPolling();
            }
        }

        function renderRoomInfo(roomData) {
            // åŸºæœ¬æƒ…å ±ã‚’è¡¨ç¤º
            document.getElementById('room-key-display').textContent = roomData.roomKey;
            document.getElementById('player-count').textContent = roomData.players.length;
            document.getElementById('max-players').textContent = roomData.settings.maxPlayers;
            document.getElementById('round-count').textContent = roomData.settings.roundCount;

            // ãƒ›ã‚¹ãƒˆã‹ã©ã†ã‹ã‚’ç¢ºèª
            console.log('ãƒ›ã‚¹ãƒˆåˆ¤å®š:', {
                hostId: roomData.hostId,
                currentUserId: currentUser.id,
                currentUser: currentUser
            });
            isHost = roomData.hostId === currentUser.id;

            // ã‚²ãƒ¼ãƒ é–‹å§‹çŠ¶æ…‹ã‚’ãƒã‚§ãƒƒã‚¯ï¼ˆå…¨ãƒ—ãƒ¬ã‚¤ãƒ¤ãƒ¼ç”¨ï¼‰
            if (roomData.status === 'playing') {
                console.log('ã‚²ãƒ¼ãƒ ãŒé–‹å§‹ã•ã‚Œã¾ã—ãŸã€‚ã‚²ãƒ¼ãƒ ç”»é¢ã«ç§»å‹•ã—ã¾ã™...');
                stopPolling(); // ãƒãƒ¼ãƒªãƒ³ã‚°ã‚’åœæ­¢
                showGameStartMessage();
                setTimeout(() => {
                    window.location.href = `/online/views/online_game.html?roomId=${roomId}`;
                }, 2000); // 2ç§’å¾Œã«ã‚²ãƒ¼ãƒ ç”»é¢ã«ç§»å‹•
                return;
            }

            // ãƒ—ãƒ¬ã‚¤ãƒ¤ãƒ¼ãƒªã‚¹ãƒˆã‚’è¡¨ç¤º
            renderPlayerList(roomData.players);

            // ãƒœã‚¿ãƒ³ã®çŠ¶æ…‹ã‚’æ›´æ–°
            updateButtons(roomData);
        }

        function renderPlayerList(players) {
            const playersList = document.getElementById('players-list');
            playersList.innerHTML = '';

            players.forEach(player => {
                const playerElement = document.createElement('div');
                playerElement.className = 'player-item';

                const readyStatus = player.isReady ? 'âœ… æº–å‚™å®Œäº†' : 'â³ å¾…æ©Ÿä¸­';
                const hostBadge = player.isHost ? 'ğŸ‘‘ ' : '';

                playerElement.innerHTML = `
                    <div class="player-info">
                        <span class="player-name">${hostBadge}${player.username}</span>
                        <span class="player-status ${player.isReady ? 'ready' : 'waiting'}">${readyStatus}</span>
                    </div>
                `;

                playersList.appendChild(playerElement);
            });
        }

        function updateButtons(roomData) {
            const readyBtn = document.getElementById('ready-btn');

            if (isHost) {
                // ãƒ›ã‚¹ãƒˆã®å ´åˆ - æº–å‚™ãƒœã‚¿ãƒ³ã‚’ã‚²ãƒ¼ãƒ ã‚¹ã‚¿ãƒ¼ãƒˆãƒœã‚¿ãƒ³ã«å¤‰æ›´
                readyBtn.style.display = 'block';

                // å…¨å“¡ãŒæº–å‚™å®Œäº†ã‹ãƒã‚§ãƒƒã‚¯
                const allReady = roomData.players.every(p => p.isHost || p.isReady);
                const hasEnoughPlayers = roomData.players.length >= 2;

                console.log('ãƒ›ã‚¹ãƒˆç”¨ãƒœã‚¿ãƒ³çŠ¶æ…‹:', {
                    allReady,
                    hasEnoughPlayers,
                    playersCount: roomData.players.length,
                    players: roomData.players.map(p => ({ name: p.username, isReady: p.isReady, isHost: p.isHost }))
                });

                // ãƒœã‚¿ãƒ³ã‚’ã‚²ãƒ¼ãƒ ã‚¹ã‚¿ãƒ¼ãƒˆãƒœã‚¿ãƒ³ã®ã‚¹ã‚¿ã‚¤ãƒ«ã«å¤‰æ›´
                readyBtn.className = 'lobby-start-game-button';
                readyBtn.disabled = !allReady || !hasEnoughPlayers;

                // æ˜Ÿã®SVGã‚’è¿½åŠ 
                if (!readyBtn.querySelector('.star-1')) {
                    readyBtn.innerHTML = `
                        Game Start !!
                        <div class="star-1">
                            <svg xmlns="http://www.w3.org/2000/svg" xml:space="preserve" version="1.1" style="shape-rendering:geometricPrecision; text-rendering:geometricPrecision; image-rendering:optimizeQuality; fill-rule:evenodd; clip-rule:evenodd" viewBox="0 0 784.11 815.53">
                                <path class="fil0" d="M392.05 0c-20.9,210.08 -184.06,378.41 -392.05,407.78 207.96,29.37 371.12,197.68 392.05,407.74 20.93,-210.06 184.09,-378.37 392.05,-407.74 -207.98,-29.38 -371.16,-197.69 -392.06,-407.78z"></path>
                            </svg>
                        </div>
                        <div class="star-2">
                            <svg xmlns="http://www.w3.org/2000/svg" xml:space="preserve" version="1.1" style="shape-rendering:geometricPrecision; text-rendering:geometricPrecision; image-rendering:optimizeQuality; fill-rule:evenodd; clip-rule:evenodd" viewBox="0 0 784.11 815.53">
                                <path class="fil0" d="M392.05 0c-20.9,210.08 -184.06,378.41 -392.05,407.78 207.96,29.37 371.12,197.68 392.05,407.74 20.93,-210.06 184.09,-378.37 392.05,-407.74 -207.98,-29.38 -371.16,-197.69 -392.06,-407.78z"></path>
                            </svg>
                        </div>
                        <div class="star-3">
                            <svg xmlns="http://www.w3.org/2000/svg" xml:space="preserve" version="1.1" style="shape-rendering:geometricPrecision; text-rendering:geometricPrecision; image-rendering:optimizeQuality; fill-rule:evenodd; clip-rule:evenodd" viewBox="0 0 784.11 815.53">
                                <path class="fil0" d="M392.05 0c-20.9,210.08 -184.06,378.41 -392.05,407.78 207.96,29.37 371.12,197.68 392.05,407.74 20.93,-210.06 184.09,-378.37 392.05,-407.74 -207.98,-29.38 -371.16,-197.69 -392.06,-407.78z"></path>
                            </svg>
                        </div>
                        <div class="star-4">
                            <svg xmlns="http://www.w3.org/2000/svg" xml:space="preserve" version="1.1" style="shape-rendering:geometricPrecision; text-rendering:geometricPrecision; image-rendering:optimizeQuality; fill-rule:evenodd; clip-rule:evenodd" viewBox="0 0 784.11 815.53">
                                <path class="fil0" d="M392.05 0c-20.9,210.08 -184.06,378.41 -392.05,407.78 207.96,29.37 371.12,197.68 392.05,407.74 20.93,-210.06 184.09,-378.37 392.05,-407.74 -207.98,-29.38 -371.16,-197.69 -392.06,-407.78z"></path>
                            </svg>
                        </div>
                        <div class="star-5">
                            <svg xmlns="http://www.w3.org/2000/svg" xml:space="preserve" version="1.1" style="shape-rendering:geometricPrecision; text-rendering:geometricPrecision; image-rendering:optimizeQuality; fill-rule:evenodd; clip-rule:evenodd" viewBox="0 0 784.11 815.53">
                                <path class="fil0" d="M392.05 0c-20.9,210.08 -184.06,378.41 -392.05,407.78 207.96,29.37 371.12,197.68 392.05,407.74 20.93,-210.06 184.09,-378.37 392.05,-407.74 -207.98,-29.38 -371.16,-197.69 -392.06,-407.78z"></path>
                            </svg>
                        </div>
                        <div class="star-6">
                            <svg xmlns="http://www.w3.org/2000/svg" xml:space="preserve" version="1.1" style="shape-rendering:geometricPrecision; text-rendering:geometricPrecision; image-rendering:optimizeQuality; fill-rule:evenodd; clip-rule:evenodd" viewBox="0 0 784.11 815.53">
                                <path class="fil0" d="M392.05 0c-20.9,210.08 -184.06,378.41 -392.05,407.78 207.96,29.37 371.12,197.68 392.05,407.74 20.93,-210.06 184.09,-378.37 392.05,-407.74 -207.98,-29.38 -371.16,-197.69 -392.06,-407.78z"></path>
                            </svg>
                        </div>
                    `;
                }

                if (allReady && hasEnoughPlayers) {
                    readyBtn.querySelector('svg').style.display = ''; // æ˜Ÿã‚’è¡¨ç¤º
                } else {
                    // ç„¡åŠ¹çŠ¶æ…‹ã®ãƒ†ã‚­ã‚¹ãƒˆã‚’è¨­å®š
                    if (!hasEnoughPlayers) {
                        readyBtn.childNodes[0].textContent = 'æœ€ä½2äººå¿…è¦ã§ã™';
                    } else {
                        readyBtn.childNodes[0].textContent = 'GameStart !!';
                    }
                }

            } else {
                // å‚åŠ è€…ã®å ´åˆ - é€šå¸¸ã®æº–å‚™ãƒœã‚¿ãƒ³
                readyBtn.style.display = 'block';
                readyBtn.className = 'submit-btn';

                const currentUserId = currentUser.id;
                const currentPlayer = roomData.players.find(p => {
                    const playerId = p.userId._id || p.userId;
                    return playerId === currentUserId;
                });
                const isCurrentlyReady = currentPlayer ? currentPlayer.isReady : false;

                readyBtn.textContent = isCurrentlyReady ? 'æº–å‚™å®Œäº† âœ…' : 'æº–å‚™OK';
                if (isCurrentlyReady) {
                    readyBtn.className += ' ready-active';
                }
                readyBtn.disabled = false;
            }
        }

        async function handleReadyOrStart() {
            if (isHost) {
                // ãƒ›ã‚¹ãƒˆã®å ´åˆã¯ã‚²ãƒ¼ãƒ é–‹å§‹
                await startGame();
            } else {
                // å‚åŠ è€…ã®å ´åˆã¯æº–å‚™çŠ¶æ…‹åˆ‡ã‚Šæ›¿ãˆ
                await toggleReady();
            }
        }

        async function toggleReady() {
            try {
                const readyBtn = document.getElementById('ready-btn');
                const isCurrentlyReady = readyBtn.textContent.includes('âœ…');

                console.log('æº–å‚™çŠ¶æ…‹å¤‰æ›´é–‹å§‹:', { isCurrentlyReady, newState: !isCurrentlyReady });

                const response = await fetch(`/multi/rooms/${roomId}/ready`, {
                    method: 'PUT',
                    headers: {
                        'Content-Type': 'application/json'
                    },
                    credentials: 'include',
                    body: JSON.stringify({
                        isReady: !isCurrentlyReady
                    })
                });

                console.log('æº–å‚™çŠ¶æ…‹å¤‰æ›´ãƒ¬ã‚¹ãƒãƒ³ã‚¹:', response.status, response.ok);

                if (!response.ok) {
                    const errorText = await response.text();
                    console.error('æº–å‚™çŠ¶æ…‹å¤‰æ›´HTTP Error:', response.status, errorText);
                    showError(`æº–å‚™çŠ¶æ…‹ã®æ›´æ–°ã«å¤±æ•—ã—ã¾ã—ãŸ (${response.status})`);
                    return;
                }

                const data = await response.json();
                console.log('æº–å‚™çŠ¶æ…‹å¤‰æ›´ãƒ‡ãƒ¼ã‚¿:', data);

                if (data.success) {
                    // ç›´æ¥ãƒœã‚¿ãƒ³ã®çŠ¶æ…‹ã‚’æ›´æ–°ï¼ˆãƒãƒ¼ãƒªãƒ³ã‚°ã§åŒæœŸã‚’å–ã‚‹ï¼‰
                    updateReadyButton(data.data.isReady);

                    // ãƒ«ãƒ¼ãƒ æƒ…å ±ã®æ›´æ–°ã¯å¿…è¦ãªå ´åˆã®ã¿è¡Œã†
                    try {
                        await updateRoomInfo();
                    } catch (updateError) {
                        console.warn('ãƒ«ãƒ¼ãƒ æƒ…å ±æ›´æ–°ã§ã‚¨ãƒ©ãƒ¼ãŒç™ºç”Ÿã—ã¾ã—ãŸãŒã€æº–å‚™çŠ¶æ…‹ã®å¤‰æ›´ã¯æˆåŠŸã—ã¾ã—ãŸ:', updateError);
                        // ãƒ«ãƒ¼ãƒ æƒ…å ±æ›´æ–°ã®ã‚¨ãƒ©ãƒ¼ã¯è‡´å‘½çš„ã§ã¯ãªã„ãŸã‚ã€ãƒãƒ¼ãƒªãƒ³ã‚°ã§å›å¾©ã‚’æœŸå¾…
                    }
                } else {
                    showError(data.message || 'æº–å‚™çŠ¶æ…‹ã®æ›´æ–°ã«å¤±æ•—ã—ã¾ã—ãŸ');
                }

            } catch (error) {
                console.error('æº–å‚™çŠ¶æ…‹æ›´æ–°ã‚¨ãƒ©ãƒ¼:', error);
                showError(`æº–å‚™çŠ¶æ…‹ã®å¤‰æ›´ã§ãƒãƒƒãƒˆãƒ¯ãƒ¼ã‚¯ã‚¨ãƒ©ãƒ¼ãŒç™ºç”Ÿã—ã¾ã—ãŸ: ${error.message}`);
            }
        }

        // æº–å‚™ãƒœã‚¿ãƒ³ã®çŠ¶æ…‹ã‚’ç›´æ¥æ›´æ–°ã™ã‚‹é–¢æ•°
        function updateReadyButton(isReady) {
            const readyBtn = document.getElementById('ready-btn');
            if (readyBtn && !isHost) {
                readyBtn.textContent = isReady ? 'æº–å‚™å®Œäº† âœ…' : 'æº–å‚™OK';
                if (isReady) {
                    readyBtn.className = 'submit-btn ready-active';
                } else {
                    readyBtn.className = 'submit-btn';
                }
            }
        }

        // --- game.jsã‹ã‚‰ç§»æ¤ã—ãŸé«˜å“è³ªãªåº§æ¨™ç”Ÿæˆãƒ­ã‚¸ãƒƒã‚¯ ---
        const TOKYO_23_WARDS_POLYGON=[[35.676,139.692],[35.69,139.701],[35.695,139.715],[35.686,139.723],[35.68,139.74],[35.67,139.748],[35.66,139.752],[35.648,139.747],[35.642,139.737],[35.639,139.725],[35.645,139.71],[35.658,139.69],[35.67,139.685],[35.685,139.69],[35.693,139.678],[35.702,139.683],[35.708,139.695],[35.715,139.702],[35.72,139.715],[35.728,139.72],[35.735,139.71],[35.742,139.715],[35.748,139.725],[35.755,139.735],[35.762,139.745],[35.768,139.752],[35.775,139.758],[35.785,139.765],[35.795,139.772],[35.805,139.78],[35.815,139.785],[35.825,139.792],[35.835,139.8],[35.845,139.808],[35.855,139.815],[35.865,139.825],[35.872,139.835],[35.878,139.845],[35.882,139.855],[35.885,139.865],[35.88,139.87],[35.875,139.875],[35.868,139.868],[35.86,139.86],[35.85,139.855],[35.84,139.848],[35.828,139.842],[35.815,139.835],[35.805,139.828],[35.795,139.82],[35.785,139.812],[35.775,139.805],[35.765,139.798],[35.755,139.792],[35.745,139.785],[35.735,139.778],[35.725,139.77],[35.715,139.762],[35.705,139.755],[35.695,139.748],[35.685,139.742],[35.675,139.735],[35.665,139.728],[35.655,139.72],[35.645,139.712],[35.635,139.705],[35.625,139.698],[35.615,139.692],[35.605,139.685],[35.595,139.678],[35.585,139.672],[35.575,139.665],[35.565,139.658],[35.555,139.652],[35.545,139.645],[35.54,139.638],[35.545,139.628],[35.552,139.618],[35.56,139.608],[35.57,139.598],[35.58,139.59],[35.59,139.582],[35.6,139.575],[35.61,139.568],[35.62,139.562],[35.63,139.555],[35.64,139.55],[35.65,139.545],[35.66,139.54],[35.67,139.535],[35.68,139.53],[35.688,139.538],[35.695,139.548],[35.702,139.558],[35.708,139.568],[35.715,139.578],[35.722,139.588],[35.73,139.598],[35.738,139.608],[35.745,139.618],[35.752,139.628],[35.76,139.638],[35.768,139.648],[35.775,139.658],[35.782,139.668],[35.788,139.678],[35.795,139.688],[35.802,139.698],[35.808,139.708],[35.815,139.718],[35.676,139.692]];
        const WATER_EXCLUSION_ZONES=[{name:"æ±äº¬æ¹¾",polygon:[[35.53,139.75],[35.53,139.87],[35.62,139.87],[35.63,139.82],[35.64,139.78],[35.65,139.76]]},{name:"éš…ç”°å·",polygon:[[35.66,139.78],[35.665,139.785],[35.72,139.8],[35.75,139.81],[35.76,139.815],[35.758,139.82],[35.718,139.805],[35.663,139.785],[35.658,139.782]]},{name:"è’å·",polygon:[[35.76,139.815],[35.78,139.825],[35.82,139.845],[35.85,139.865],[35.852,139.87],[35.848,139.872],[35.818,139.85],[35.778,139.83],[35.758,139.82]]},{name:"çš‡å±…æ¿ ",polygon:[[35.679,139.744],[35.685,139.75],[35.69,139.756],[35.688,139.762],[35.682,139.76],[35.677,139.754]]}];
        const MAJOR_ROAD_ZONES=[{center:[35.681,139.767],radius:800,weight:3},{center:[35.689,139.692],radius:600,weight:3},{center:[35.659,139.701],radius:600,weight:3},{center:[35.729,139.731],radius:500,weight:2},{center:[35.63,139.74],radius:500,weight:2},{center:[35.67,139.802],radius:500,weight:2},{center:[35.696,139.614],radius:400,weight:2},{center:[35.738,139.669],radius:400,weight:2},{center:[35.643,139.716],radius:400,weight:2},{center:[35.712,139.61],radius:400,weight:2},{center:[35.7,139.773],radius:300,weight:1},{center:[35.646,139.71],radius:300,weight:1},{center:[35.665,139.731],radius:300,weight:1},{center:[35.667,139.65],radius:300,weight:1}];
        const pointInPolygon=(t,o,n)=>{let e=!1;for(let s=0,a=n.length-1;s<n.length;a=s++)n[s][0]>t!=n[a][0]>t&&o<(n[a][1]-n[s][1])*(t-n[s][0])/(n[a][0]-n[s][0])+n[s][1]&&(e=!e);return e};
        const isValidLocation=(t,o)=>{if(!pointInPolygon(t,o,TOKYO_23_WARDS_POLYGON))return!1;for(const n of WATER_EXCLUSION_ZONES)if(pointInPolygon(t,o,n.polygon))return!1;return!0};
        const generateWeightedRandomLocation=()=>{const t=MAJOR_ROAD_ZONES.reduce((t,o)=>t+o.weight,0);let o=Math.random()*t;let n=MAJOR_ROAD_ZONES[0];for(const t of MAJOR_ROAD_ZONES)if(o-=t.weight,o<=0){n=t;break}const e=2*Math.random()*Math.PI,s=Math.random()*n.radius,a=n.center[0]+s*Math.cos(e)/111320,r=n.center[1]+s*Math.sin(e)/(111320*Math.cos(n.center[0]*Math.PI/180));return{lat:a,lng:r}};

        async function checkStreetView(lat, lng, radius) {
            const response = await fetch('/api/streetview/check', {
                method: 'POST',
                headers: { 'Content-Type': 'application/json' },
                body: JSON.stringify({ lat, lng, radius })
            });
            const data = await response.json();
            if (data.success && data.data.status === 'OK') {
                return { lat: data.data.location.lat, lng: data.data.location.lng };
            }
            return null;
        }

        async function findValidLocation(generationFunc, checkRadius) {
            let attempts = 0;
            while (attempts < 50) {
                const { lat, lng } = generationFunc();
                if (isValidLocation(lat, lng)) {
                    const svLocation = await checkStreetView(lat, lng, checkRadius);
                    if (svLocation) {
                        return svLocation;
                    }
                }
                attempts++;
            }
            console.warn('æœ‰åŠ¹ãªå ´æ‰€ã®æ¤œç´¢ãŒã‚¿ã‚¤ãƒ ã‚¢ã‚¦ãƒˆã—ã¾ã—ãŸã€‚ãƒ•ã‚©ãƒ¼ãƒ«ãƒãƒƒã‚¯ã—ã¾ã™ã€‚');
            return null;
        }

        async function generateTargetLocation() {
            const location = await findValidLocation(() => {
                return Math.random() < 0.8 ? generateWeightedRandomLocation() : { lat: 35.53 + Math.random() * 0.35, lng: 139.34 + Math.random() * 0.54 };
            }, 500);
            return location || { lat: 35.681236, lng: 139.767125 }; // ãƒ•ã‚©ãƒ¼ãƒ«ãƒãƒƒã‚¯: æ±äº¬é§…
        }

        // å„ãƒ—ãƒ¬ã‚¤ãƒ¤ãƒ¼ã«ç•°ãªã‚‹ã‚¹ãƒãƒ¼ãƒ³ä½ç½®ã‚’ç”Ÿæˆï¼ˆ3kmåœå†…ç¢ºå®Ÿï¼‰
        function generatePlayerStartPosition(targetLocation, playerIndex = 0, totalPlayers = 1) {
            // ãƒ—ãƒ¬ã‚¤ãƒ¤ãƒ¼ã”ã¨ã«ç•°ãªã‚‹è§’åº¦ç¯„å›²ã‚’å‰²ã‚Šå½“ã¦
            const angleSegment = (2 * Math.PI) / Math.max(totalPlayers, 2);
            const baseAngle = angleSegment * playerIndex;
            const angleVariation = angleSegment * 0.8; // ã‚»ã‚°ãƒ¡ãƒ³ãƒˆå†…ã§ã®ãƒ©ãƒ³ãƒ€ãƒ å¤‰å‹•

            const angle = baseAngle + (Math.random() * angleVariation - angleVariation / 2);
            const distance = 500 + Math.random() * 2500; // 500mï½3000mï¼ˆãƒ•ãƒ©ãƒƒã‚°ã‹ã‚‰é›¢ã‚ŒãŸä½ç½®ï¼‰

            // åº§æ¨™è¨ˆç®—ï¼ˆé«˜ç²¾åº¦ï¼‰
            const lat = targetLocation.lat + (distance * Math.cos(angle)) / 111320;
            const lng = targetLocation.lng + (distance * Math.sin(angle)) / (111320 * Math.cos(targetLocation.lat * Math.PI / 180));

            console.log(`ãƒ—ãƒ¬ã‚¤ãƒ¤ãƒ¼${playerIndex + 1}ã®ã‚¹ãƒãƒ¼ãƒ³: è§’åº¦${(angle * 180 / Math.PI).toFixed(1)}Â°, è·é›¢${distance.toFixed(0)}m`);

            return { lat, lng };
        }
        // --- ã“ã“ã¾ã§ç§»æ¤ã—ãŸãƒ­ã‚¸ãƒƒã‚¯ ---

        async function startGame() {
            try {
                console.log('ã‚²ãƒ¼ãƒ ã‚’é–‹å§‹ã—ã¦ã„ã¾ã™...');
                const startBtn = document.getElementById('ready-btn');
                startBtn.disabled = true;
                startBtn.childNodes[0].textContent = 'åº§æ¨™ã‚’ç”Ÿæˆä¸­...';

                // 1. å…±é€šã®ç›®æ¨™åœ°ç‚¹ã‚’ç”Ÿæˆ
                const targetLocation = await generateTargetLocation();
                console.log('ç”Ÿæˆã•ã‚ŒãŸç›®æ¨™åœ°ç‚¹:', targetLocation);

                // 2. å‚åŠ ãƒ—ãƒ¬ã‚¤ãƒ¤ãƒ¼ã‚’å–å¾—
                const roomResponse = await fetch(`/multi/rooms/${roomId}`);
                const roomData = await roomResponse.json();
                if (!roomData.success) {
                    throw new Error('ãƒ—ãƒ¬ã‚¤ãƒ¤ãƒ¼æƒ…å ±ã®å–å¾—ã«å¤±æ•—ã—ã¾ã—ãŸã€‚');
                }
                const players = roomData.data.players;

                // 3. ãƒ—ãƒ¬ã‚¤ãƒ¤ãƒ¼é–‹å§‹ä½ç½®ã¯ã‚¯ãƒ©ã‚¤ã‚¢ãƒ³ãƒˆå´ã§å€‹åˆ¥ç”Ÿæˆã™ã‚‹ãŸã‚å‰Šé™¤
                console.log('ã‚¿ãƒ¼ã‚²ãƒƒãƒˆä½ç½®ãŒç”Ÿæˆã•ã‚Œã¾ã—ãŸã€‚å„ãƒ—ãƒ¬ã‚¤ãƒ¤ãƒ¼ã¯å€‹åˆ¥ã«ã‚¹ãƒãƒ¼ãƒ³ä½ç½®ã‚’æ±ºå®šã—ã¾ã™ã€‚');
                startBtn.childNodes[0].textContent = 'ã‚²ãƒ¼ãƒ ã‚’é–‹å§‹ä¸­...';

                // ã‚²ãƒ¼ãƒ é–‹å§‹APIã‚’å‘¼ã³å‡ºã™ï¼ˆã‚¿ãƒ¼ã‚²ãƒƒãƒˆä½ç½®ã®ã¿é€ä¿¡ï¼‰
                const response = await fetch(`/multi/rooms/${roomId}/start`, {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json'
                    },
                    credentials: 'include',
                    body: JSON.stringify({
                        targetLocation: targetLocation
                    })
                });

                // è©³ç´°ãªãƒ¬ã‚¹ãƒãƒ³ã‚¹æƒ…å ±ã‚’ãƒ­ã‚°å‡ºåŠ›
                console.log('ã‚²ãƒ¼ãƒ é–‹å§‹API ãƒ¬ã‚¹ãƒãƒ³ã‚¹:', {
                    status: response.status,
                    ok: response.ok,
                    headers: Object.fromEntries(response.headers.entries())
                });

                if (!response.ok) {
                    const errorText = await response.text();
                    console.error('ã‚²ãƒ¼ãƒ é–‹å§‹HTTP Error:', response.status, errorText);
                    showError(`ã‚²ãƒ¼ãƒ é–‹å§‹ã«å¤±æ•—ã—ã¾ã—ãŸ (${response.status}): ${errorText}`);
                startBtn.disabled = false;
                startBtn.childNodes[0].textContent = 'Game Start !!';
                    return;
                }

                const data = await response.json();
                console.log('ã‚²ãƒ¼ãƒ é–‹å§‹API ãƒ‡ãƒ¼ã‚¿:', data);

                if (data.success) {
                    console.log('ã‚²ãƒ¼ãƒ é–‹å§‹æˆåŠŸ:', data);
                    stopPolling(); // ãƒãƒ¼ãƒªãƒ³ã‚°ã‚’åœæ­¢
                    showGameStartMessage();
                    // ãƒ›ã‚¹ãƒˆã‚‚ã‚²ãƒ¼ãƒ ç”»é¢ã«ç§»å‹•
                    setTimeout(() => {
                        window.location.href = `/online/views/online_game.html?roomId=${roomId}`;
                    }, 2000);
                } else {
                    console.error('ã‚²ãƒ¼ãƒ é–‹å§‹å¤±æ•—:', data);
                    showError(data.message || 'ã‚²ãƒ¼ãƒ ã®é–‹å§‹ã«å¤±æ•—ã—ã¾ã—ãŸ');
                startBtn.disabled = false;
                startBtn.childNodes[0].textContent = 'Game Start !!';
                }

            } catch (error) {
                console.error('ã‚²ãƒ¼ãƒ é–‹å§‹ã‚¨ãƒ©ãƒ¼:', error);
                showError(`ã‚²ãƒ¼ãƒ é–‹å§‹ã§ãƒãƒƒãƒˆãƒ¯ãƒ¼ã‚¯ã‚¨ãƒ©ãƒ¼ãŒç™ºç”Ÿã—ã¾ã—ãŸ: ${error.message}`);
                const startBtn = document.getElementById('ready-btn'); // ã‚¨ãƒ©ãƒ¼æ™‚ã‚‚ãƒœã‚¿ãƒ³ã‚’æˆ»ã™
                startBtn.disabled = false;
            startBtn.childNodes[0].textContent = 'Game Start !!';
            }
        }

        async function leaveRoom() {
            if (!confirm('ãƒ«ãƒ¼ãƒ ã‚’é€€å‡ºã—ã¾ã™ã‹ï¼Ÿ')) {
                return;
            }

            try {
                const response = await fetch(`/multi/rooms/${roomId}/leave`, {
                    method: 'DELETE',
                    credentials: 'include'
                });

                const data = await response.json();

                if (data.success) {
                    window.location.href = '/rooms';
                } else {
                    showError(data.message || 'ãƒ«ãƒ¼ãƒ é€€å‡ºã«å¤±æ•—ã—ã¾ã—ãŸ');
                }

            } catch (error) {
                console.error('ãƒ«ãƒ¼ãƒ é€€å‡ºã‚¨ãƒ©ãƒ¼:', error);
                showError('ãƒãƒƒãƒˆãƒ¯ãƒ¼ã‚¯ã‚¨ãƒ©ãƒ¼ãŒç™ºç”Ÿã—ã¾ã—ãŸ');
            }
        }

        function startPolling() {
            pollInterval = setInterval(updateRoomInfo, 3000); // 3ç§’ã”ã¨ã«æ›´æ–°
        }

        function stopPolling() {
            if (pollInterval) {
                clearInterval(pollInterval);
                pollInterval = null;
            }
        }

        function showError(message) {
            const errorElement = document.getElementById('error-display');
            if (errorElement) {
                errorElement.textContent = message;
                errorElement.style.display = 'block';
            }
        }

        function showGameStartMessage() {
            // æ—¢å­˜ã®ã‚¨ãƒ©ãƒ¼ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ã‚’éš ã™
            const errorElement = document.getElementById('error-display');
            if (errorElement) {
                errorElement.style.display = 'none';
            }

            // ã‚²ãƒ¼ãƒ é–‹å§‹ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ã‚’è¡¨ç¤º
            const messageElement = document.createElement('div');
            messageElement.className = 'game-start-message';
            messageElement.innerHTML = `
                <div style="background-color: rgba(46, 204, 113, 0.1); border: 2px solid #2ecc71; border-radius: 8px; padding: 1.5rem; margin-bottom: 1rem; color: #27ae60; text-align: center; font-size: 1.2rem; font-weight: bold;">
                    ğŸ® ã‚²ãƒ¼ãƒ ãŒé–‹å§‹ã•ã‚Œã¾ã—ãŸï¼<br>
                    <span style="font-size: 1rem; font-weight: normal;">ã‚²ãƒ¼ãƒ ç”»é¢ã«ç§»å‹•ã—ã¦ã„ã¾ã™...</span>
                </div>
            `;

            const mainContent = document.querySelector('.main-content');
            const firstChild = mainContent.firstElementChild;
            mainContent.insertBefore(messageElement, firstChild);
        }

        // ãƒšãƒ¼ã‚¸ã‚’é›¢ã‚Œã‚‹æ™‚ã«ãƒãƒ¼ãƒªãƒ³ã‚°ã‚’åœæ­¢
        window.addEventListener('beforeunload', () => {
            stopPolling();
        });

        // ã‚³ãƒ”ãƒ¼æ©Ÿèƒ½
        async function copyRoomKey() {
            const roomKey = document.getElementById('room-key-display').textContent;
            const copyBtn = document.getElementById('copy-btn');

            try {
                await navigator.clipboard.writeText(roomKey);

                const originalText = copyBtn.textContent;
                copyBtn.textContent = 'âœ…';
                copyBtn.style.color = '#28a745';

                setTimeout(() => {
                    copyBtn.textContent = originalText;
                    copyBtn.style.color = '';
                }, 2000);

            } catch (error) {
                console.error('ã‚¯ãƒªãƒƒãƒ—ãƒœãƒ¼ãƒ‰ã‚³ãƒ”ãƒ¼ã‚¨ãƒ©ãƒ¼:', error);
                alert('ãƒ«ãƒ¼ãƒ ã‚­ãƒ¼ã‚’ã‚³ãƒ”ãƒ¼ã§ãã¾ã›ã‚“ã§ã—ãŸ: ' + roomKey);
            }
        }
    </script>

    <div class="page-container">
        <header class="page-header">
            <h1 class="page-title">ãƒ«ãƒ¼ãƒ ãƒ­ãƒ“ãƒ¼</h1>
            <p style="color: white; text-shadow: 1px 1px 2px rgba(0,0,0,0.7); margin-top: 1rem; font-size: 1.1rem;">
                ãƒ—ãƒ¬ã‚¤ãƒ¤ãƒ¼ãŒé›†ã¾ã‚‹ã®ã‚’å¾…ã£ã¦ã„ã¾ã™
            </p>
        </header>

        <main class="main-content">
            <!-- ã‚¨ãƒ©ãƒ¼è¡¨ç¤º -->
            <div id="error-display" class="error-message" style="display: none;"></div>

            <!-- ãƒ«ãƒ¼ãƒ æƒ…å ±ã¨ãƒ—ãƒ¬ã‚¤ãƒ¤ãƒ¼ãƒªã‚¹ãƒˆã®ã‚³ãƒ³ãƒ†ãƒŠ -->
            <div class="room-info-container">
                <!-- ãƒ«ãƒ¼ãƒ æƒ…å ±ã‚«ãƒ¼ãƒ‰ -->
                <div class="auth-box room-info-card">
                    <h2 class="auth-title">ğŸ  ãƒ«ãƒ¼ãƒ æƒ…å ±</h2>

                    <!-- ãƒ«ãƒ¼ãƒ ã‚­ãƒ¼è¡¨ç¤º -->
                    <div class="room-key-display">
                        <span class="label">ãƒ«ãƒ¼ãƒ ã‚­ãƒ¼:</span>
                        <span id="room-key-display" class="room-key">------</span>
                        <button id="copy-btn" class="copy-btn" title="ãƒ«ãƒ¼ãƒ ã‚­ãƒ¼ã‚’ã‚³ãƒ”ãƒ¼" onclick="copyRoomKey()">ğŸ“‹</button>
                    </div>

                    <!-- ãƒ«ãƒ¼ãƒ è¨­å®šæƒ…å ± -->
                    <div class="room-details">
                        <p><strong>å‚åŠ è€…:</strong> <span id="player-count">0</span>/<span id="max-players">4</span>äºº</p>
                        <p><strong>ãƒ©ã‚¦ãƒ³ãƒ‰æ•°:</strong> <span id="round-count">3</span>ãƒ©ã‚¦ãƒ³ãƒ‰</p>
                    </div>
                </div>

                <!-- ãƒ—ãƒ¬ã‚¤ãƒ¤ãƒ¼ãƒªã‚¹ãƒˆ -->
                <div class="auth-box players-card">
                    <h3 class="auth-title">ğŸ‘¥ å‚åŠ ãƒ—ãƒ¬ã‚¤ãƒ¤ãƒ¼</h3>
                    <div id="players-list" class="players-list">
                        <!-- ãƒ—ãƒ¬ã‚¤ãƒ¤ãƒ¼ã¯JavaScriptã§å‹•çš„ã«è¿½åŠ ã•ã‚Œã¾ã™ -->
                    </div>
                </div>
            </div>

            <!-- ã‚¢ã‚¯ã‚·ãƒ§ãƒ³ãƒœã‚¿ãƒ³ -->
            <div style="max-width: 500px; margin: 0 auto;">
                <div class="action-buttons">
                    <button id="ready-btn" class="submit-btn" style="display: none;">æº–å‚™OK</button>
                    <button id="leave-room-btn" class="secondary-btn">ãƒ«ãƒ¼ãƒ ã‚’é€€å‡º</button>
                </div>

                <!-- ãƒ˜ãƒ«ãƒ—ãƒ†ã‚­ã‚¹ãƒˆ -->
                <div style="margin-top: 1.5rem; padding: 1rem; background-color: rgba(52, 152, 219, 0.1); border-radius: 8px; border: 1px solid rgba(52, 152, 219, 0.3);">
                    <p style="margin: 0; font-size: 0.9rem; color: #2c3e50;">
                        <strong>ğŸ’¡ ã‚²ãƒ¼ãƒ é–‹å§‹æ¡ä»¶:</strong><br>
                        â€¢ æœ€ä½2äººã®ãƒ—ãƒ¬ã‚¤ãƒ¤ãƒ¼ãŒå¿…è¦ã§ã™<br>
                        â€¢ å…¨ã¦ã®å‚åŠ è€…ãŒã€Œæº–å‚™OKã€çŠ¶æ…‹ã«ãªã‚‹å¿…è¦ãŒã‚ã‚Šã¾ã™<br>
                        â€¢ ãƒ›ã‚¹ãƒˆãŒã€Œã‚²ãƒ¼ãƒ é–‹å§‹ã€ãƒœã‚¿ãƒ³ã‚’æŠ¼ã™ã¨ã‚²ãƒ¼ãƒ ãŒå§‹ã¾ã‚Šã¾ã™
                    </p>
                </div>
            </div>
        </main>
    </div>

    <style>
        .players-list {
            display: flex;
            flex-direction: column;
            gap: 0.8rem;
        }

        .player-item {
            background-color: rgba(255, 255, 255, 0.5);
            border-radius: 8px;
            padding: 1rem;
            border: 1px solid rgba(0, 0, 0, 0.1);
        }

        .player-info {
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .player-name {
            font-weight: bold;
            color: #2c3e50;
        }

        .player-status {
            font-size: 0.9rem;
            font-weight: bold;
        }

        .player-status.ready {
            color: #27ae60;
        }

        .player-status.waiting {
            color: #f39c12;
        }

        .ready-active {
            background: linear-gradient(135deg, #27ae60, #229954) !important;
        }

        .error-message {
            background-color: rgba(231, 76, 60, 0.1);
            border: 2px solid #e74c3c;
            border-radius: 8px;
            padding: 1rem;
            margin-bottom: 1rem;
            color: #e74c3c;
            text-align: center;
        }

        /* ãƒ›ã‚¹ãƒˆç”¨ã‚²ãƒ¼ãƒ ã‚¹ã‚¿ãƒ¼ãƒˆãƒœã‚¿ãƒ³ã®ã‚¹ã‚¿ã‚¤ãƒ«ï¼ˆrules.htmlã‹ã‚‰å¿œç”¨ï¼‰ */
        .lobby-start-game-button {
            position: relative;
            padding: 20px 50px;
            margin: 20px auto;
            display: block;
            background: #fec195;
            font-size: 24px;
            font-weight: 600;
            color: #181818;
            border: 4px solid #fec195;
            border-radius: 12px;
            box-shadow: 0 0 0 #fec1958c;
            transition: all 0.3s ease-in-out;
            cursor: pointer;
            text-align: center;
            max-width: 400px;
            width: 100%;
            min-height: 80px;
        }

        .lobby-start-game-button:disabled {
            background: #cccccc;
            border-color: #cccccc;
            color: #666666;
            cursor: not-allowed;
        }

        .lobby-start-game-button:disabled .star-1,
        .lobby-start-game-button:disabled .star-2,
        .lobby-start-game-button:disabled .star-3,
        .lobby-start-game-button:disabled .star-4,
        .lobby-start-game-button:disabled .star-5,
        .lobby-start-game-button:disabled .star-6 {
            display: none;
        }

        .lobby-start-game-button .star-1,
        .lobby-start-game-button .star-2,
        .lobby-start-game-button .star-3,
        .lobby-start-game-button .star-4,
        .lobby-start-game-button .star-5,
        .lobby-start-game-button .star-6 {
            position: absolute;
            filter: drop-shadow(0 0 0 #fffdef);
            z-index: -5;
            transition: all 1s cubic-bezier(0.05, 0.83, 0.43, 0.96);
        }

        .lobby-start-game-button .star-1 {
            top: 20%;
            left: 20%;
            width: 25px;
            height: auto;
        }

        .lobby-start-game-button .star-2 {
            top: 45%;
            left: 45%;
            width: 15px;
            height: auto;
        }

        .lobby-start-game-button .star-3 {
            top: 40%;
            left: 40%;
            width: 5px;
            height: auto;
        }

        .lobby-start-game-button .star-4 {
            top: 20%;
            left: 40%;
            width: 8px;
            height: auto;
        }

        .lobby-start-game-button .star-5 {
            top: 25%;
            left: 45%;
            width: 15px;
            height: auto;
        }

        .lobby-start-game-button .star-6 {
            top: 5%;
            left: 50%;
            width: 5px;
            height: auto;
        }

        .lobby-start-game-button:not(:disabled):hover {
            background: transparent;
            color: #fec195;
            box-shadow: 0 0 25px #fec1958c;
        }

        .lobby-start-game-button:not(:disabled):hover .star-1 {
            top: -80%;
            left: -30%;
            filter: drop-shadow(0 0 10px #fffdef);
            z-index: 2;
        }

        .lobby-start-game-button:not(:disabled):hover .star-2 {
            top: -25%;
            left: 10%;
            filter: drop-shadow(0 0 10px #fffdef);
            z-index: 2;
        }

        .lobby-start-game-button:not(:disabled):hover .star-3 {
            top: 55%;
            left: 25%;
            filter: drop-shadow(0 0 10px #fffdef);
            z-index: 2;
        }

        .lobby-start-game-button:not(:disabled):hover .star-4 {
            top: 30%;
            left: 80%;
            filter: drop-shadow(0 0 10px #fffdef);
            z-index: 2;
        }

        .lobby-start-game-button:not(:disabled):hover .star-5 {
            top: 25%;
            left: 115%;
            filter: drop-shadow(0 0 10px #fffdef);
            z-index: 2;
        }

        .lobby-start-game-button:not(:disabled):hover .star-6 {
            top: 5%;
            left: 60%;
            filter: drop-shadow(0 0 10px #fffdef);
            z-index: 2;
        }

        .lobby-start-game-button .fil0 {
            fill: #fffdef;
        }

        /* ãƒ«ãƒ¼ãƒ æƒ…å ±ã¨ãƒ—ãƒ¬ã‚¤ãƒ¤ãƒ¼ãƒªã‚¹ãƒˆã®æ¨ªä¸¦ã³ */
        .room-info-container {
            display: flex;
            gap: 2rem;
            width: 100%;
            max-width: 1000px;
            margin: 0 auto 2rem auto;
            align-items: flex-start;
        }

        .room-info-card,
        .players-card {
            flex: 1;
            max-width: none;
            min-width: 300px;
        }

        .room-info-card {
            flex-basis: 45%;
        }

        .players-card {
            flex-basis: 55%;
        }

        @media (max-width: 768px) {
            .room-info-container {
                flex-direction: column;
                gap: 1.5rem;
            }

            .room-info-card,
            .players-card {
                flex-basis: auto;
                max-width: 500px;
                margin: 0 auto;
            }
        }

        @media (max-width: 480px) {
            .player-info {
                flex-direction: column;
                align-items: flex-start;
                gap: 0.5rem;
            }

            .room-info-container {
                gap: 1rem;
            }
        }
    </style>
</body>
</html>