<!DOCTYPE html>
<html>

<head>
    <title>東京3kmチャレンジ - ルール</title>
    <meta charset="utf-8">
    <link rel="stylesheet" href="style.css">
    <style>
        body {
            background-image: url('images/pageimage.jpg');
            background-size: cover;
            background-position: center;
            background-attachment: fixed;
            margin: 0;
            padding: 20px;
            font-family: Arial, sans-serif;
        }
        
        .rules-container {
            max-width: 800px;
            margin: 0 auto;
            padding: 20px;
            background-color: rgba(255, 255, 255, 0.7);
            border-radius: 10px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
            margin-top: 20px;
        }
        
        .rules-section {
            margin-bottom: 30px;
        }
        
        .rules-section h2 {
            color: #1a73e8;
            border-bottom: 2px solid #1a73e8;
            padding-bottom: 10px;
            margin-bottom: 15px;
        }
        
        .rules-section h3 {
            color: #ff6b35;
            margin-top: 20px;
            margin-bottom: 10px;
        }
        
        .rules-section p, .rules-section li {
            line-height: 1.6;
            margin-bottom: 10px;
        }
        
        .rules-section ul {
            padding-left: 20px;
        }
        
        .highlight {
            background-color: #fff3cd;
            padding: 15px;
            border-radius: 5px;
            border-left: 4px solid #ff6b35;
            margin: 15px 0;
        }
        
        .start-game-button {
            position: relative;
            padding: 12px 35px;
            margin: 30px auto;
            display: block;
            text-decoration: none;
            background: #fec195;
            font-size: 17px;
            font-weight: 500;
            color: #181818;
            border: 3px solid #fec195;
            border-radius: 8px;
            box-shadow: 0 0 0 #fec1958c;
            transition: all 0.3s ease-in-out;
            cursor: pointer;
            text-align: center;
            max-width: 250px;
        }

        .start-game-button .star-1 {
            position: absolute;
            top: 20%;
            left: 20%;
            width: 25px;
            height: auto;
            filter: drop-shadow(0 0 0 #fffdef);
            z-index: -5;
            transition: all 1s cubic-bezier(0.05, 0.83, 0.43, 0.96);
        }

        .start-game-button .star-2 {
            position: absolute;
            top: 45%;
            left: 45%;
            width: 15px;
            height: auto;
            filter: drop-shadow(0 0 0 #fffdef);
            z-index: -5;
            transition: all 1s cubic-bezier(0, 0.4, 0, 1.01);
        }

        .start-game-button .star-3 {
            position: absolute;
            top: 40%;
            left: 40%;
            width: 5px;
            height: auto;
            filter: drop-shadow(0 0 0 #fffdef);
            z-index: -5;
            transition: all 1s cubic-bezier(0, 0.4, 0, 1.01);
        }

        .start-game-button .star-4 {
            position: absolute;
            top: 20%;
            left: 40%;
            width: 8px;
            height: auto;
            filter: drop-shadow(0 0 0 #fffdef);
            z-index: -5;
            transition: all 0.8s cubic-bezier(0, 0.4, 0, 1.01);
        }

        .start-game-button .star-5 {
            position: absolute;
            top: 25%;
            left: 45%;
            width: 15px;
            height: auto;
            filter: drop-shadow(0 0 0 #fffdef);
            z-index: -5;
            transition: all 0.6s cubic-bezier(0, 0.4, 0, 1.01);
        }

        .start-game-button .star-6 {
            position: absolute;
            top: 5%;
            left: 50%;
            width: 5px;
            height: auto;
            filter: drop-shadow(0 0 0 #fffdef);
            z-index: -5;
            transition: all 0.8s ease;
        }

        .start-game-button:hover {
            background: transparent;
            color: #fec195;
            box-shadow: 0 0 25px #fec1958c;
        }

        .start-game-button:hover .star-1 {
            position: absolute;
            top: -80%;
            left: -30%;
            width: 25px;
            height: auto;
            filter: drop-shadow(0 0 10px #fffdef);
            z-index: 2;
        }

        .start-game-button:hover .star-2 {
            position: absolute;
            top: -25%;
            left: 10%;
            width: 15px;
            height: auto;
            filter: drop-shadow(0 0 10px #fffdef);
            z-index: 2;
        }

        .start-game-button:hover .star-3 {
            position: absolute;
            top: 55%;
            left: 25%;
            width: 5px;
            height: auto;
            filter: drop-shadow(0 0 10px #fffdef);
            z-index: 2;
        }

        .start-game-button:hover .star-4 {
            position: absolute;
            top: 30%;
            left: 80%;
            width: 8px;
            height: auto;
            filter: drop-shadow(0 0 10px #fffdef);
            z-index: 2;
        }

        .start-game-button:hover .star-5 {
            position: absolute;
            top: 25%;
            left: 115%;
            width: 15px;
            height: auto;
            filter: drop-shadow(0 0 10px #fffdef);
            z-index: 2;
        }

        .start-game-button:hover .star-6 {
            position: absolute;
            top: 5%;
            left: 60%;
            width: 5px;
            height: auto;
            filter: drop-shadow(0 0 10px #fffdef);
            z-index: 2;
        }

        .start-game-button .fil0 {
            fill: #fffdef;
        }

        h1 {
            text-align: center;
            color: #fff;
            font-size: 2.5em;
            margin: 20px 0 30px 0;
            text-shadow: 2px 2px 4px rgba(0,0,0,0.7);
        }
    </style>
</head>

<body>
    <h1>Lost Point Guesser - ルールブック</h1>
    
    <div class="rules-container">
        <div class="rules-section">
            <h2>🎯 ゲームの目的</h2>
            <p>東京都内のランダムな地点に設置された<strong>赤いフラッグ</strong>を目指すゲームです。ストリートビューで街を探索し、フラッグの位置をできるだけ正確に特定してください。</p>
        </div>
        
        <div class="rules-section">
            <h2>📋 基本ルール</h2>
            <ul>
                <li><strong>スタート地点：</strong> フラッグから3km以内のランダムな地点からスタートします</li>
                <li><strong>目標：</strong> ストリートビューを使って街を探索し、赤いフラッグを見つけてください</li>
                <li><strong>操作方法：</strong> ストリートビューで自由に移動・回転して探索できます</li>
                <li><strong>推測：</strong> フラッグの位置を特定したら「GUESS」ボタンを押してください</li>
                <li><strong>結果：</strong> 現在位置とフラッグとの距離が表示されます</li>
            </ul>
        </div>
        
        <div class="rules-section">
            <h2>🔍 特別機能</h2>
            <h3>HINT機能</h3>
            <p><strong>「HINT」</strong>ボタンを使用すると：</p>
            <ul>
                <li>現在位置からフラッグまでの正確な距離が数十秒間表示されます</li>
                <li>マップ上にフラッグを中心とした赤い円が描画されます（円の境界上にあなたがいます）</li>
                <li><strong>注意：</strong> この機能は1ゲームにつき1回だけ使用可能です</li>
                <li><strong>制限：</strong> HINT使用後はGUESSするとボタンが無効化されます</li>
            </ul>
            
            <div class="highlight">
                <strong>💡 戦略のヒント：</strong><br>
                HINT機能は戦略的に使用しましょう。ある程度探索してから使用することで、より効率的にフラッグを見つけることができます。HINTを使った後は慎重に最終位置を決めましょう。
            </div>
        </div>
        
        <div class="rules-section">
            <h2>🗺️ ゲーム画面の見方</h2>
            <ul>
                <li><strong>左半分：</strong> ストリートビュー（探索用）</li>
                <li><strong>右半分：</strong> マップ（フラッグと現在位置が表示されます）</li>
                <li><strong>赤いフラッグマーカー：</strong> 目的地</li>
                <li><strong>青いマーカー：</strong> あなたの推測位置（GUESS後に表示）</li>
                <li><strong>破線：</strong> フラッグと推測位置を結ぶ線（GUESS後に表示）</li>
            </ul>
        </div>
        
        <div class="rules-section">
            <h2>🏆 スコアリング</h2>
            <p>推測の精度は距離で測定されます。フラッグに近いほど良いスコアです！</p>
            <ul>
                <li><strong>素晴らしい：</strong> 100m以内</li>
                <li><strong>良い：</strong> 500m以内</li>
                <li><strong>まずまず：</strong> 1km以内</li>
                <li><strong>要改善：</strong> 1km以上</li>
            </ul>
        </div>
        
        <div class="rules-section">
            <h2>📱 操作のコツ</h2>
            <ul>
                <li>ストリートビューでは矢印キーやマウスドラッグで移動・回転できます</li>
                <li>道路標識、建物、ランドマークを手がかりにしましょう</li>
                <li>マップで大まかな位置関係を把握しましょう</li>
                <li>HINT機能は慎重なタイミングで使用しましょう</li>
            </ul>
        </div>
    </div>
    
    <a href="#" id="startGameButton" class="start-game-button">
        Game Start !!
        <div class="star-1">
            <svg xmlns="http://www.w3.org/2000/svg" xml:space="preserve" version="1.1" style="shape-rendering:geometricPrecision; text-rendering:geometricPrecision; image-rendering:optimizeQuality; fill-rule:evenodd; clip-rule:evenodd" viewBox="0 0 784.11 815.53" xmlns:xlink="http://www.w3.org/1999/xlink">
                <defs></defs>
                <g id="Layer_x0020_1">
                    <metadata id="CorelCorpID_0Corel-Layer"></metadata>
                    <path class="fil0" d="M392.05 0c-20.9,210.08 -184.06,378.41 -392.05,407.78 207.96,29.37 371.12,197.68 392.05,407.74 20.93,-210.06 184.09,-378.37 392.05,-407.74 -207.98,-29.38 -371.16,-197.69 -392.06,-407.78z"></path>
                </g>
            </svg>
        </div>
        <div class="star-2">
            <svg xmlns="http://www.w3.org/2000/svg" xml:space="preserve" version="1.1" style="shape-rendering:geometricPrecision; text-rendering:geometricPrecision; image-rendering:optimizeQuality; fill-rule:evenodd; clip-rule:evenodd" viewBox="0 0 784.11 815.53" xmlns:xlink="http://www.w3.org/1999/xlink">
                <defs></defs>
                <g id="Layer_x0020_1">
                    <metadata id="CorelCorpID_0Corel-Layer"></metadata>
                    <path class="fil0" d="M392.05 0c-20.9,210.08 -184.06,378.41 -392.05,407.78 207.96,29.37 371.12,197.68 392.05,407.74 20.93,-210.06 184.09,-378.37 392.05,-407.74 -207.98,-29.38 -371.16,-197.69 -392.06,-407.78z"></path>
                </g>
            </svg>
        </div>
        <div class="star-3">
            <svg xmlns="http://www.w3.org/2000/svg" xml:space="preserve" version="1.1" style="shape-rendering:geometricPrecision; text-rendering:geometricPrecision; image-rendering:optimizeQuality; fill-rule:evenodd; clip-rule:evenodd" viewBox="0 0 784.11 815.53" xmlns:xlink="http://www.w3.org/1999/xlink">
                <defs></defs>
                <g id="Layer_x0020_1">
                    <metadata id="CorelCorpID_0Corel-Layer"></metadata>
                    <path class="fil0" d="M392.05 0c-20.9,210.08 -184.06,378.41 -392.05,407.78 207.96,29.37 371.12,197.68 392.05,407.74 20.93,-210.06 184.09,-378.37 392.05,-407.74 -207.98,-29.38 -371.16,-197.69 -392.06,-407.78z"></path>
                </g>
            </svg>
        </div>
        <div class="star-4">
            <svg xmlns="http://www.w3.org/2000/svg" xml:space="preserve" version="1.1" style="shape-rendering:geometricPrecision; text-rendering:geometricPrecision; image-rendering:optimizeQuality; fill-rule:evenodd; clip-rule:evenodd" viewBox="0 0 784.11 815.53" xmlns:xlink="http://www.w3.org/1999/xlink">
                <defs></defs>
                <g id="Layer_x0020_1">
                    <metadata id="CorelCorpID_0Corel-Layer"></metadata>
                    <path class="fil0" d="M392.05 0c-20.9,210.08 -184.06,378.41 -392.05,407.78 207.96,29.37 371.12,197.68 392.05,407.74 20.93,-210.06 184.09,-378.37 392.05,-407.74 -207.98,-29.38 -371.16,-197.69 -392.06,-407.78z"></path>
                </g>
            </svg>
        </div>
        <div class="star-5">
            <svg xmlns="http://www.w3.org/2000/svg" xml:space="preserve" version="1.1" style="shape-rendering:geometricPrecision; text-rendering:geometricPrecision; image-rendering:optimizeQuality; fill-rule:evenodd; clip-rule:evenodd" viewBox="0 0 784.11 815.53" xmlns:xlink="http://www.w3.org/1999/xlink">
                <defs></defs>
                <g id="Layer_x0020_1">
                    <metadata id="CorelCorpID_0Corel-Layer"></metadata>
                    <path class="fil0" d="M392.05 0c-20.9,210.08 -184.06,378.41 -392.05,407.78 207.96,29.37 371.12,197.68 392.05,407.74 20.93,-210.06 184.09,-378.37 392.05,-407.74 -207.98,-29.38 -371.16,-197.69 -392.06,-407.78z"></path>
                </g>
            </svg>
        </div>
        <div class="star-6">
            <svg xmlns="http://www.w3.org/2000/svg" xml:space="preserve" version="1.1" style="shape-rendering:geometricPrecision; text-rendering:geometricPrecision; image-rendering:optimizeQuality; fill-rule:evenodd; clip-rule:evenodd" viewBox="0 0 784.11 815.53" xmlns:xlink="http://www.w3.org/1999/xlink">
                <defs></defs>
                <g id="Layer_x0020_1">
                    <metadata id="CorelCorpID_0Corel-Layer"></metadata>
                    <path class="fil0" d="M392.05 0c-20.9,210.08 -184.06,378.41 -392.05,407.78 207.96,29.37 371.12,197.68 392.05,407.74 20.93,-210.06 184.09,-378.37 392.05,-407.74 -207.98,-29.38 -371.16,-197.69 -392.06,-407.78z"></path>
                </g>
            </svg>
        </div>
    </a>

    <script>
        document.getElementById('startGameButton').addEventListener('click', async function(e) {
            e.preventDefault();

            try {
                // ログイン状態をチェック
                const response = await fetch('/auth/me');
                const data = await response.json();

                if (data.success && data.user) {
                    // ログイン済み：ゲーム画面に遷移
                    window.location.href = '/game';
                } else {
                    // 未ログイン：ログイン画面に遷移（戻り先を指定）
                    window.location.href = `/login?returnUrl=${encodeURIComponent('/game')}`;
                }
            } catch (error) {
                console.error('ログイン状態の確認に失敗:', error);
                // エラー時もログイン画面に遷移
                window.location.href = `/login?returnUrl=${encodeURIComponent('/game')}`;
            }
        });
    </script>
</body>

</html>